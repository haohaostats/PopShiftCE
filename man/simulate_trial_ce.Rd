% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate.R
\name{simulate_trial_ce}
\alias{simulate_trial_ce}
\title{Simulate a single two-stage trial using the MC-CE decision rule}
\usage{
simulate_trial_ce(
  n1,
  n2,
  delta,
  piZ,
  theta,
  eta,
  sigmaY,
  error_type = c("normal", "t", "skew"),
  muX_C,
  muX_T = NULL,
  sigmaX,
  gamma0,
  gamma1,
  mu0,
  lookup,
  pi_fixed = 0.5
)
}
\arguments{
\item{n1, n2}{Stage-1/Stage-2 per-arm sample sizes.}

\item{delta}{Treatment main effect in the Z=0 stratum.}

\item{piZ}{Stage-2 shift prevalence for Z=1.}

\item{theta}{Main effect of Z.}

\item{eta}{Interaction T:Z.}

\item{sigmaY}{SD of the primary outcome error.}

\item{error_type}{One of \code{"normal"}, \code{"t"}, \code{"skew"}.}

\item{muX_C}{Stage-1 surrogate mean in control.}

\item{muX_T}{Stage-1 surrogate mean in treatment. If \code{NULL}, it is set
internally to \code{muX_C + delta/gamma1} to align the interim mean with the
primary effect as in the paper.}

\item{sigmaX}{SD of the Stage-1 surrogate.}

\item{gamma0, gamma1}{External linear calibration coefficients for the surrogate.}

\item{mu0}{Baseline intercept for the primary outcome.}

\item{lookup}{A CE lookup object returned by \code{build_ce_lookup()}.}

\item{pi_fixed}{Design-fixed mixture prevalence used in the estimand.}
}
\value{
A list with fields:
\describe{
\item{reject}{Logical, whether H0 was rejected (either early or final).}
\item{early_stop}{Logical, whether early efficacy was triggered.}
\item{final_est}{Final-stage estimate of the marginal effect (NA if early stop).}
\item{final_se}{Final-stage SE (NA if early stop).}
\item{lcl_final}{Final CE-consistent one-sided lower bound (NA if early stop).}
\item{lcl_interim}{Interim one-sided lower bound on the surrogate scale (NA if not early stop).}
\item{coverage_final}{Indicator for final LCL covering the true effect (NA if early stop).}
\item{coverage_overall}{Overall coverage (interim or final bound, depending on stop).}
\item{sample_used_total}{Total sample size used across arms.}
\item{sample_used_per_arm}{Per-arm sample size used.}
\item{z1}{Observed interim statistic T1 (for plotting/diagnostics).}
\item{zf}{Final-stage z-statistic S_final (NA if early stop).}
\item{cz1}{Conditional critical value c(T1) used at final, or b_ref if early stop.}
}
}
\description{
This simulates one seamless two-stage trial:
Stage 1 uses a surrogate-only interim (via \code{gen_stage1_and_T1}).
If early efficacy is declared (T1 >= b_ref), it stops and returns the
surrogate-scale one-sided LCL. Otherwise it proceeds to Stage 2, fits the
full-data primary model (via \code{final_analysis}), and applies the
conditional critical value \code{c(T1)} from the CE lookup.
}
